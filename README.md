# tinywasm Client
<!-- START_SECTION:BADGES_SECTION -->
<a href="docs/img/badges.svg"><img src="docs/img/badges.svg" alt="Project Badges" title="Generated by devflow from github.com/tinywasm/devflow"></a>
<!-- END_SECTION:BADGES_SECTION -->

Intelligent WebAssembly compilation manager for Go with automatic project detection and a 3-mode compiler system.

## üöÄ Features

- **3-Mode Compiler System**:
  - `L` (Large): Standard Go compiler for fast development.
  - `M` (Medium): TinyGo with debug optimizations (`-opt=1`).
  - `S` (Small): TinyGo with size optimizations (`-opt=z`).
- **Interactive Integration**: Implements DevTUI `FieldHandler` for real-time mode switching.
- **Smart Detection**: Automatically identifies WASM projects and compiler requirements.
- **Developer Experience**: Auto-configures VS Code with appropriate `GOOS/GOARCH` settings.
- **Flexible Output**: Support for in-memory serving or physical file output.

## üõ† Usage

### Basic Initialization

`client` uses a combination of a `Config` struct for core paths and public setter methods for advanced configuration.

```go
// 1. Create base configuration
cfg := client.NewConfig()
// Customize source and output directories if needed (must be functions)
cfg.SourceDir = func() string { return "web" }
cfg.OutputDir = func() string { return "web/public" }

// 2. Initialize client
twc := client.New(cfg)

// 3. Fine-tune configuration via setters
twc.SetAppRootDir("/path/to/project")
twc.SetMainInputFile("app.go")      // default: "client.go"
twc.SetOutputName("app")            // default: "client"
twc.SetBuildShortcuts("L", "M", "S") // customize mode triggers

// (Optional) Enable physical wasm_exec.js output for file watchers/debug
twc.SetWasmExecJsOutputDir("web/theme/js")
```

### Project Initialization

`client` provides helpers to quickly set up a new WASM project. This includes generating a default `client.go` and configuring `.vscode/settings.json` for proper `gopls` support (handling `GOOS=js` and `GOARCH=wasm`).

```go
// Generate default client.go and .vscode configuration if they don't exist
twc.CreateDefaultWasmFileClientIfNotExist()
```

### Mode Switching (DevTUI Integration)

Switching modes is asynchronous and reports status via the configured Logger.

```go
// Switch to Small (Production) mode
twc.Change("S")
```

You can also retrieve the current shortcuts mapping:

```go
shortcuts := twc.Shortcuts()
// returns []map[string]string, e.g., [{"L": "Large (stLib)"}, ...]
```

## üèó Core Concepts

### Dual Output Architecture

`client` handles two types of outputs to optimize the build pipeline:

1.  **WASM Binary** (via `OutputDir`): The final WebAssembly file loaded by the browser.
2.  **JavaScript Runtime**: Mode-specific `wasm_exec.js`.
    - **WasmClient Integration**: Recommended to use `twc.GetSSRClientInitJS()` to get the content directly for embedding or serving.
    - **Standalone Handler**: Use `client.Javascript` for a lightweight, reusable component that generates the WASM initialization JavaScript without the full `WasmClient` logic.
    - **Disk-based**: Use `twc.SetWasmExecJsOutputDir()` if you need a physical file for external bundlers or mode-transparency for other tools.

### Serving Strategies

The library automatically selects the best way to compile and serve the WASM binary:
- **In-Memory**: Compiles directly to a buffer (fastest for development).
- **External**: Compiles and serves from disk (useful for static integration).

Logic details are available in [strategies.go](strategies.go).

### VS Code Integration

On initialization, `client` can auto-create `.vscode/settings.json` to ensure `gopls` correctly recognizes the WASM environment:
```json
{"gopls": {"env": {"GOOS": "js", "GOARCH": "wasm"}}}
```

## ‚öôÔ∏è Configuration

`client` follows a hybrid configuration approach:
- **`Config` Struct**: Used for shared dependencies (`Store`, `Logger`) and relative directory structures (`SourceDir`, `OutputDir`). See [config.go](config.go).
- **Public Setters**: Used for project-specific overrides (`AppRootDir`, `MainInputFile`, `OutputName`) and build behavioral changes. These setters are reactive and re-initialize internal state automatically.

## üìã Requirements

- Go 1.21+
- [TinyGo](https://tinygo.org/) (optional, required for Medium/Small modes)

## [Contributing](https://github.com/cdvelop/cdvelop/blob/main/CONTRIBUTING.md)
